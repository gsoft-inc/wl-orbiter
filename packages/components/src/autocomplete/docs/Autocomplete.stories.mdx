import { ArgsTable, Meta, Story } from "@storybook/addon-docs";
import { Autocomplete, InnerAutocomplete } from "@components/autocomplete";
import { Avatar } from "@components/avatar";
import { ComponentInfo, Preview, Tagline } from "@stories/components";
import { IconList } from "@components/icons";
import { CatIcon, RocketIcon, SearchIcon, SparklesIcon } from "@hopper-ui/icons";
import { InnerItem, InnerSection, Item, Section } from "@components/collection";
import { Text } from "@components/typography";

<Meta
    title="Components/Autocomplete"
    id="autocomplete"
/>

# Autocomplete

<Tagline>An autocomplete is a normal text input enhanced by a panel of suggested options.</Tagline>

<ComponentInfo
    usage={"import { Autocomplete, Item, Section } from \"@workleap/orbiter-ui\";"}
    ariaPath="combobox"
    githubPath="/packages/components/src/autocomplete/src"
/>

## Usage

### Default

A default autocomplete

<Preview>
    <Story name="default">
        <Autocomplete placeholder="Planets" aria-label="Planets">
            <Item key="earth">Earth</Item>
            <Item key="jupiter">Jupiter</Item>
            <Item key="mars">Mars</Item>
            <Item key="mercury">Mercury</Item>
            <Item key="neptune">Neptune</Item>
            <Item key="saturn">Saturn</Item>
            <Item key="uranus">Uranus</Item>
        </Autocomplete>
    </Story>
</Preview>

### Sections

An autocomplete items can be group by sections.

<Preview>
    <Story name="sections">
        <Autocomplete placeholder="Planets" aria-label="Planets">
            <Section title="Visited">
                <Item key="earth">Earth</Item>
                <Item key="mars">Mars</Item>
                <Item key="saturn">Saturn</Item>
            </Section>
            <Section title="Not Visited">
                <Item key="jupiter">Jupiter</Item>
                <Item key="mercury">Mercury</Item>
                <Item key="neptune">Neptune</Item>
                <Item key="uranus">Uranus</Item>
            </Section>
        </Autocomplete>
    </Story>
</Preview>

### Item icon

An autocomplete item can have [icons](?path=/docs/icon-gallery--page).

<Preview>
    <Story name="item icon">
        <Autocomplete placeholder="Planets" aria-label="Planets">
            <Item key="earth">
                <SparklesIcon />
                <Text>Earth</Text>
            </Item>
            <Item key="jupiter">
                <SparklesIcon />
                <Text>Jupiter</Text>
            </Item>
            <Item key="mars">
                <SparklesIcon />
                <Text>Mars</Text>
            </Item>
        </Autocomplete>
    </Story>
</Preview>

### Item end icon

An autocomplete item can have *non standard* end [icons](?path=/docs/icon-gallery--page) can be provided to handle special cases like displaying a list of icons. However, think twice before adding *end* icons, *start* icons should be your go to.

<Preview>
    <Story name="item end icon">
        <Autocomplete placeholder="Planets" aria-label="Planets">
            <Item key="earth">
                <Text>Earth</Text>
                <IconList slot="end-icon">
                    <RocketIcon />
                    <CatIcon />
                    <SparklesIcon />
                </IconList>
            </Item>
            <Item key="jupiter">
                <Text>Jupiter</Text>
                <SparklesIcon slot="end-icon" />
            </Item>
            <Item key="mars">
                <Text>Mars</Text>
                <IconList slot="end-icon">
                    <RocketIcon />
                    <CatIcon />
                    <SparklesIcon />
                </IconList>
            </Item>
        </Autocomplete>
    </Story>
</Preview>

### Item description

An autocomplete item can have a description.

<Preview>
    <Story name="item description">
        <Autocomplete placeholder="Planets" aria-label="Planets">
            <Item key="earth">
                <Text>Earth</Text>
                <Text slot="description">Home sweet home!</Text>
            </Item>
            <Item key="jupiter">
                <Text>Jupiter</Text>
                <Text slot="description">The fourth-brightest object in the sky</Text>
            </Item>
            <Item key="mars">
                <Text>Mars</Text>
                <Text slot="description">See you in 2026</Text>
            </Item>
        </Autocomplete>
    </Story>
</Preview>

A description can be paired with an [icon](?path=/docs/icon-gallery--page).

<Preview>
    <Story name="item description + icon">
        <Autocomplete placeholder="Planets" aria-label="Planets">
            <Item key="earth">
                <SparklesIcon />
                <Text>Earth</Text>
                <Text slot="description">Home sweet home!</Text>
            </Item>
            <Item key="jupiter">
                <SparklesIcon />
                <Text>Jupiter</Text>
                <Text slot="description">The fourth-brightest object in the sky</Text>
            </Item>
            <Item key="mars">
                <SparklesIcon />
                <Text>Mars</Text>
                <Text slot="description">See you in 2026</Text>
            </Item>
        </Autocomplete>
    </Story>
</Preview>

A description can be paired with an [avatar](?path=/docs/avatar--default-story).

<Preview>
    <Story name="item description + avatar">
        <Autocomplete placeholder="Planets" aria-label="Planets">
            <Item key="earth">
                <Avatar name="Earth" />
                <Text>Earth</Text>
                <Text slot="description">Home sweet home!</Text>
            </Item>
            <Item key="jupiter">
                <Avatar name="Jupiter" />
                <Text>Jupiter</Text>
                <Text slot="description">The fourth-brightest object in the sky</Text>
            </Item>
            <Item key="mars">
                <Avatar name="Mars" />
                <Text>Mars</Text>
                <Text slot="description">See you in 2026</Text>
            </Item>
        </Autocomplete>
    </Story>
</Preview>

### Trigger icon

An autocomplete trigger can have an icon.

<Preview>
    <Story name="trigger icon">
        <Autocomplete icon={<SearchIcon />} placeholder="Planets" aria-label="Planets">
            <Item key="earth">Earth</Item>
            <Item key="jupiter">Jupiter</Item>
            <Item key="mars">Mars</Item>
            <Item key="mercury">Mercury</Item>
            <Item key="neptune">Neptune</Item>
            <Item key="saturn">Saturn</Item>
            <Item key="uranus">Uranus</Item>
        </Autocomplete>
    </Story>
</Preview>

### Disabled

<Preview>
    <Story name="disabled">
        <Autocomplete disabled placeholder="Planets" aria-label="Planets">
            <Item key="earth">Earth</Item>
            <Item key="jupiter">Jupiter</Item>
            <Item key="mars">Mars</Item>
            <Item key="mercury">Mercury</Item>
            <Item key="neptune">Neptune</Item>
            <Item key="saturn">Saturn</Item>
            <Item key="uranus">Uranus</Item>
        </Autocomplete>
    </Story>
</Preview>

### Readonly

<Preview>
    <Story name="readonly">
        <Autocomplete readOnly placeholder="Planets" aria-label="Planets">
            <Item key="earth">Earth</Item>
            <Item key="jupiter">Jupiter</Item>
            <Item key="mars">Mars</Item>
            <Item key="mercury">Mercury</Item>
            <Item key="neptune">Neptune</Item>
            <Item key="saturn">Saturn</Item>
            <Item key="uranus">Uranus</Item>
        </Autocomplete>
    </Story>
</Preview>

### Fluid

An autocomplete can take the width of it's container.

<Preview>
    <Story name="fluid">
        <Autocomplete fluid placeholder="Planets" aria-label="Planets">
            <Item key="earth">Earth</Item>
            <Item key="jupiter">Jupiter</Item>
            <Item key="mars">Mars</Item>
            <Item key="mercury">Mercury</Item>
            <Item key="neptune">Neptune</Item>
            <Item key="saturn">Saturn</Item>
            <Item key="uranus">Uranus</Item>
        </Autocomplete>
    </Story>
</Preview>

### Validation

An autocomplete can display a validation state to communicate to the user whether the current value is valid or invalid. Implement your own validation logic in your app and pass either `"valid"` or `"invalid"` to the input via the `validationState` prop.

The example below illustrates how one would validate that a specific value have been selected.

<Preview filePath="/autocomplete/docs/SelectedValueValidation" />

### Form

An autocomplete can be part of a form. To submit the value of a select, make sure you specify the `name` property.

<Preview>
    <Story name="form">
        <form>
            <Autocomplete name="planet" placeholder="Planets" aria-label="Planets">
                <Item key="earth">Earth</Item>
                <Item key="jupiter">Jupiter</Item>
                <Item key="mars">Mars</Item>
                <Item key="mercury">Mercury</Item>
                <Item key="neptune">Neptune</Item>
                <Item key="saturn">Saturn</Item>
                <Item key="uranus">Uranus</Item>
            </Autocomplete>
        </form>
    </Story>
</Preview>

### Dynamic items

An autocomplete items can be rendered dynamically.

<Preview>
    <Story name="dynamic items">
        <Autocomplete placeholder="Planets" aria-label="Planets">
            {["Earth", "Jupiter", "Mars", "Mercury", "Neptune", "Saturn", "Uranus"].map(x => (
                <Item key={x.toLowerCase()}>{x}</Item>
            ))}
        </Autocomplete>
    </Story>
</Preview>

### Remote items

An autocomplete items can be fetch from a remote source.

We provide an utility hook called `useAsyncSearch` which accept an *async* function responsible of fetching the data. You could roll your own utility hook as long as it returns a *loading indicator* and provide a function to handle *search* requests.

> In most cases, you should pass the [`signal`](https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal) arg to your `fetch` request.

<Preview filePath="/autocomplete/docs/RemoteItems" scope={{ ApiKey: "8aa06f2e50msh9ff37516b3c0282p1e8624jsn81c867aa0d74" }} />

### Custom search

An autocomplete search strategy can be customized by providing an `onSearch` handler.

<Preview filePath="/autocomplete/docs/CustomSearch" />

### Controlled

The `selectedKey` and `open` state can be handled in controlled mode.

<Preview filePath="/autocomplete/docs/ControlledAutocomplete" />

## API

### Autocomplete

<ComponentInfo
    usage={"import { Autocomplete } from \"@workleap/orbiter-ui\";"}
    inherits={[InnerAutocomplete.defaultElement, "styled-component"]}
    compact
/>

<ArgsTable of={InnerAutocomplete} sort="alpha" />

### Item

<ComponentInfo
    usage={"import { Item } from \"@workleap/orbiter-ui\";"}
    slots={["icon", "avatar", "text", "description", "end-icon"]}
    compact
/>

<ArgsTable of={InnerItem} sort="alpha" />

### Section

<ComponentInfo
    usage={"import { Section } from \"@workleap/orbiter-ui\";"}
    compact
/>

<ArgsTable of={InnerSection} sort="alpha" />
